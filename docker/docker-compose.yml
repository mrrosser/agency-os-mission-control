services:
  openclaw-gateway:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      args:
        OPENCLAW_VERSION: ${OPENCLAW_VERSION}
    image: ${OPENCLAW_IMAGE}
    container_name: openclaw-gateway
    restart: unless-stopped
    env_file:
      - .env
    environment:
      OPENCLAW_CONFIG_PATH: /home/openclaw/.openclaw/openclaw.json
      TS_SOCKET: /var/run/tailscale/tailscaled.sock
    volumes:
      - ../data/openclaw:/home/openclaw/.openclaw
      - ../data/gogcli:/home/openclaw/.config/gogcli
      - /var/run/tailscale/tailscaled.sock:/var/run/tailscale/tailscaled.sock
    ports:
      - "127.0.0.1:${OPENCLAW_PORT}:18789"
      - "127.0.0.1:8788:8788"
      - "127.0.0.1:8789:8789"
      - "127.0.0.1:8790:8790"
    healthcheck:
      test: ["CMD", "/bin/bash", "-lc", "echo > /dev/tcp/127.0.0.1/18789"]
      interval: 30s
      timeout: 5s
      retries: 5
